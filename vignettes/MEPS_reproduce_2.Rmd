---
title: "MEPS_reproduce_2"
author: "Andrew Edwards"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MEPS_reproduce_2}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 5.7,
  fig.height = 7
  )

```{r setup}
library(sizeSpectra)
```

## Reproducing Figures 4 and 5 of MEPS paper

The simulated data takes a while to generate, bin and fit (over an hour on a fast laptop), and so results are saved
in the list `MLEbin.MEPS.default`. This list contains the fitted maximum likelihood
value (and confidence interval) of $b$ for each simulated data set, binning
method and fitting method (MLEmid or MLEbin).

To create `MLEbin.MEPS.default` run the next line (which is not evaluated by
this vignette but is run once in `data-raw/simulate-data2.R` to save
the list as part of this package):
```{r, eval=FALSE}
MLEbin.MEPS.default <- MLEbin.simulate()
```

The list contains three items (see `?MLEbin.simulate`):
```{r}
MLEbin.results <- MLEbin.MEPS.default   # just change this to use vignette for
                                        # other results
summary(MLEbin.results)
```

Figure 4 shows histograms of the estimates of $b$ for the MLEs for both methods and all four binning types:
```{r}
MLEmid.MLEbin.hist(MLEbin.results)
```

Figure 5 gives the confidence intervals for the MLEs for both methods and all four binning types:
```{r}
# These two lines just give a different inset for panel (e):
insetMat = matrix(rep(c(-0.01, -0.04), 4),
                  ncol=2,
                  byrow=TRUE)
insetMat[3, 1] = 0.3

MLEmid.MLEbin.conf(MLEbin.results,
                   insetMat = insetMat)
```

Make a dataframe of the results and show here, reproducing Table S.3:
```{r, echo=TRUE, results='asis'}
knitr::kable(MLEmid.MLEbin.table(MLEbin.results))
```

```{r, eval = FALSE}
Original, copying to above and then editing:  kEEP ME AS example  TODO update
MEE_reproduce_2.Rmd with type="Rmd"
for(j in 1:binTypes)                    # Loop over binning type; prob should
                                        # have just made a dataframe
  {
    print(paste(binType.name[[j]],
                " | ",
                MLEmethod.name[1],
                " | ",
                qqtab(MLE.array[ ,j,1], quants=c(0.05, 0.95), latex=FALSE)),
          quote=FALSE)
    print(paste(" | ", MLEmethod.name[2], " | ",
                qqtab(MLE.array[ ,j,2], quants=c(0.05, 0.95), latex=FALSE)),
          quote=FALSE)
}
```


<!--
# Range of widths of confidence intervals, may want to quote them but
#  unlikely need to report the full table.
print("Binning type & Method & Shortest CI & Widest CI\\ \\hline", quote=FALSE)
for(binTypeInd in 1:binTypes)
  {
  rangeVals = range(MLEconf.array[ ,binTypeInd, "MLEmid", "confMax"] -
    MLEconf.array[ ,binTypeInd, "MLEmid", "confMin"])
  print(paste(binType.name[[binTypeInd]], " & ", MLEmethod.name[1], " & ",
    rangeVals[1], " & ", rangeVals[2], "\\"), quote=FALSE)

  rangeVals = range(MLEconf.array[ ,binTypeInd, "MLEbin", "confMax"] -
    MLEconf.array[ ,binTypeInd, "MLEbin", "confMin"])
  print(paste(" & ", MLEmethod.name[2], " & ",
    rangeVals[1], " & ", rangeVals[2], "\\"), quote=FALSE)
}
-->

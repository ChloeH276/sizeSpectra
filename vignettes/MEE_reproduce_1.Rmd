---
title: "MEE_reproduce_1"
author: "Andrew Edwards"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MEE_reproduce_1}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 6,
  fig.height = 6
)
```

```{r setup}
library(sizeSpectra)
```

# Reproduce Figures 1, 2 and A.1 of MEE paper

This vignette reproduces all the figures and tables in TODO: ref paper. See the
paper for details. The aim of the vignette is to enable users to reproduce the
results so that they can see what functions are appropriate for their own data,
and perform further analyses as required.


## Figure 1 - standard histogram of a random sample from a bounded power-law distribution

Generate random sample from bounded power-law distribution, where the resulting
`x` is a vector of individual fish sizes (usually body masses).
```{r}
n = 1000                  # sample size
b.known = -2              # known fixed value of b
xmin.known = 1            # known fixed value of xmin
xmax.known = 1000         # known fixed value of xmax
set.seed(42)              # To get the same observations for each run of code.

x = rPLB(n,
         b = b.known,
         xmin = xmin.known,
         xmax = xmax.known)

head(x)
```

Make the standard histogram with a break in the y-axis (by first fitting using
the Llin method since that returns the required bin breaks, counts etc.).
```{r}
num.bins = 8    # Suggested number of bins for standard histogram and Llin
                #  method; Daan et al. used 8 bins.

# hAAA is the h(istrogram) results for method AAA.
# Llin method - plotting binned data on log-linear axes then fitting regression.
hLlin = Llin.method(x,
                    num.bins = num.bins)

gap.barplot.cust(hLlin$counts,
                 midpoints = hLlin$mids,
                 breakpoints = hLlin$breaks,
                 xlim = c(-10,max(hLlin$breaks)+10),
                 col = rep("grey", length(hLlin$counts)),
                 xaxs = "i",
                 yaxs = "i"
                 )
```

## Figure 2 -- results from using eight methods to fit size spectra

Calculate size spectra fits using all eight methods on the same data set.
```{r}
eight.results = eightMethodsMEE(x, num.bins = num.bins)
```

The following code plots Figure 2, where each panel corresponds to one of the
methods. Most of this code involves details of the plots to make good figures,
and so might somewhat tailored for this explicit data set. So it may need
tweaking for another dataset. (Could be made into a function with lots of
arguments).

```{r, fig.height = 8}
eight.methods.plot(eight.results)
```

## Figure A.1

Same as (h) above (Figure 2(h) in paper), but on linear-log axes, to help explain in the
why the red curve on log-log axes in (h) above does not pass through the maximum
data point.

```{r, fig.height = 5.4}
par(mai=c(0.8, 0.8, 0.2, 0.3))
mgpVal = c(2, 0.5, 0)
plot(sort(x,
          decreasing=TRUE),
     1:length(x),
     log="x",
     xlab=expression(paste("Values, ", italic(x))),
     ylab=expression( paste("Number of ", values >= x), sep=""),
     xlim = c(min(x), max(x)), ylim = c(0, n), axes=FALSE,  mgp=mgpVal)
xLim = 10^par("usr")[1:2]
yLim = NULL

logTicks(xLim,
         yLim = NULL,
         xLabelSmall = c(5, 50, 500),
         mgp = mgpVal)

yBig = c(0, 500, 1000)
# Big labelled:
axis(2,
     at = yBig,
     labels = yBig,
     mgp = mgpVal)
# Small unlabelled:
axis(2,
     seq(yBig[1], yBig[length(yBig)], by = 100),
     labels = rep("", 11),
     tcl = -0.2,
     mgp = mgpVal)

x.PLB = seq(min(x), max(x), length=1000)     # x values to plot PLB
y.PLB = (1 - pPLB(x = x.PLB,
                  b = hMLE.list$b,
                  xmin = min(x.PLB),
                  xmax = max(x.PLB))) * length(x)
lines(x.PLB, y.PLB, col="red") #, lty=5)
```


<!--
CHECK THIS:   load(file="fitting2.RData")    # or load in data for x
From readMeCode.txt:

The resulting figures (as .eps postscript files) are also included so that
 code can be independnetly re-run and the results easily compared with my
 original figures. I have included the .RData file for the results for
 the main simulation of 10,000 data sets (multiple/fitting3rep.r)
 and for the xmax=10000 simulation (multiple/xmax10000/fitting3rep10000.r)
 because the code can take a while to run and the two resulting .RData files
 are used to produce Figure 3. The remainaing .RData files are have
 not been included because they are generally large.

The main figures in the manuscript can be found in the following directories:

Figures 1 and 2 - code/single/
Figures 3 and 4 - code/multiple/
Figure 5 - code/MLEbin/
Figure 6 - code/recommend/

So to use the MLE method to analyse your own data and plot results as per
 our Figure 6, see code/recommend/ . If your data are binned then you will
 need some of code/MLEbin/ .

code/fitting2.r  (only r file there):

# fitting2.r - replacing the fitting methods with functions, that are all
#  in PLBfunctions.r. 5th June 2015.


dev.off()

save.image(file = "fitting2.RData")
-->
